
<% if @order.paid? %>
  <% class_vals = "card border-left-3 border-left-success rounded-left-0" %>
<% else %>
  <% class_vals = "card border-left-3 border-left-danger rounded-left-0" %>
<% end %>

<div class="<%= class_vals %>">
  <div class="card-body">
    <div class="d-sm-flex align-item-sm-center flex-sm-nowrap">
      <div>
        <h6 class="font-weight-semibold"><%= @order.topic %></h6>
        <ul class="list list-unstyled mb-0">
          <li>Order #: <%= @order.code %></li>
          <li>Issued on: <span class="font-weight-semibold"><%= @order.created_at%></span></li>
        </ul>
      </div>

      <div class="text-sm-right mb-0 mt-3 mt-sm-0 ml-auto">
        <h6 class="font-weight-semibold">$<%= @order.price%></h6>
        <ul class="list list-unstyled mb-0">
          <li>Method: <span class="font-weight-semibold">SWIFT</span></li>
          <li class="dropdown">
            Status: &nbsp;
            <a href="#" class="badge bg-danger-400 align-top dropdown-toggle" data-toggle="dropdown">Overdue</a>
            <div class="dropdown-menu dropdown-menu-right">
              <a href="#" class="dropdown-item active"><i class="icon-alert"></i> Overdue</a>
              <a href="#" class="dropdown-item"><i class="icon-alarm"></i> Pending</a>
              <a href="#" class="dropdown-item"><i class="icon-checkmark3"></i> Paid</a>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item"><i class="icon-spinner2 spinner"></i> On hold</a>
              <a href="#" class="dropdown-item"><i class="icon-cross2"></i> Canceled</a>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="card-footer d-sm-flex justify-content-sm-between align-items-sm-center">
    <span>
      <span class="badge badge-mark border-danger mr-2"></span>
      Due:
      <span class="font-weight-semibold">2015/02/25</span>
    </span>

    <ul class="list-inline list-inline-condensed mb-0 mt-2 mt-sm-0">
      <li class="list-inline-item">
        <a href="#" class="text-default"><i class="icon-eye8"></i></a>
      </li>
      <li class="list-inline-item dropdown">
        <a href="#" class="text-default dropdown-toggle" data-toggle="dropdown"><i class="icon-menu7"></i></a>

        <div class="dropdown-menu dropdown-menu-right">
          <a href="#" class="dropdown-item"><i class="icon-printer"></i> Print invoice</a>
          <a href="#" class="dropdown-item"><i class="icon-file-download"></i> Download invoice</a>
          <div class="dropdown-divider"></div>
          <a href="#" class="dropdown-item"><i class="icon-file-plus"></i> Edit invoice</a>
          <a href="#" class="dropdown-item"><i class="icon-cross2"></i> Remove invoice</a>
        </div>
      </li>
    </ul>
  </div>
</div>

<% if !@order.paid? %>
<script src="https://www.paypal.com/sdk/js?client-id=<%=@client_id%>"></script>
<div id="paypal-button-container"></div>
<script>
  paypal.Buttons({
    env: '<%= @env %>', // Valid values are sandbox and live.
    createOrder: async () => {
        var csrfToken = $("meta[name='csrf-token']").attr("content");
        const config = {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'X-CSRF-Token': csrfToken
            },
            body: JSON.stringify({key: '<%= @order.key %>'})
        }
        const response = await fetch('/orders/pay', config);
        const responseData = await response.json();
        return responseData.token;
    },
    onApprove: async (data) => {
      var csrfToken = $("meta[name='csrf-token']").attr("content");
      const response = await fetch('/orders/capture_order', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': csrfToken
        },
        body: JSON.stringify({token: data.orderID})
      });
      const responseData = await response.json();
      if (responseData.status === 'COMPLETED') {
        alert('Payment success!');
        location.reload();
      }
    }
  }).render('#paypal-button-container');
</script>
<% end %>